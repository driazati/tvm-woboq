<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>codegen_aocl.cc source code [tvm/src/target/source/codegen_aocl.cc] - Woboq Code Browser</title>
<link rel="stylesheet" href="../../../.././data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../.././data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../.././data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../.././data/jquery/jquery-ui.min.js"></script>
<script>var file = 'tvm/src/target/source/codegen_aocl.cc'; var root_path = '../../../..'; var data_path = '../../../.././data'; var ecma_script_api_version = 2;</script>
<script src='../../../.././data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='../../..'>tvm</a>/<a href='../..'>src</a>/<a href='..'>target</a>/<a href='./'>source</a>/<a href='codegen_aocl.cc.html'>codegen_aocl.cc</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/*</i></td></tr>
<tr><th id="2">2</th><td><i> * Licensed to the Apache Software Foundation (ASF) under one</i></td></tr>
<tr><th id="3">3</th><td><i> * or more contributor license agreements.  See the NOTICE file</i></td></tr>
<tr><th id="4">4</th><td><i> * distributed with this work for additional information</i></td></tr>
<tr><th id="5">5</th><td><i> * regarding copyright ownership.  The ASF licenses this file</i></td></tr>
<tr><th id="6">6</th><td><i> * to you under the Apache License, Version 2.0 (the</i></td></tr>
<tr><th id="7">7</th><td><i> * "License"); you may not use this file except in compliance</i></td></tr>
<tr><th id="8">8</th><td><i> * with the License.  You may obtain a copy of the License at</i></td></tr>
<tr><th id="9">9</th><td><i> *</i></td></tr>
<tr><th id="10">10</th><td><i> *   <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></i></td></tr>
<tr><th id="11">11</th><td><i> *</i></td></tr>
<tr><th id="12">12</th><td><i> * Unless required by applicable law or agreed to in writing,</i></td></tr>
<tr><th id="13">13</th><td><i> * software distributed under the License is distributed on an</i></td></tr>
<tr><th id="14">14</th><td><i> * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</i></td></tr>
<tr><th id="15">15</th><td><i> * KIND, either express or implied.  See the License for the</i></td></tr>
<tr><th id="16">16</th><td><i> * specific language governing permissions and limitations</i></td></tr>
<tr><th id="17">17</th><td><i> * under the License.</i></td></tr>
<tr><th id="18">18</th><td><i> */</i></td></tr>
<tr><th id="19">19</th><td></td></tr>
<tr><th id="20">20</th><td><i class="doc">/*!</i></td></tr>
<tr><th id="21">21</th><td><i class="doc"> * <span class="command">\file</span> <span class="verb">codegen_aocl.cc</span></i></td></tr>
<tr><th id="22">22</th><td><i class="doc"> */</i></td></tr>
<tr><th id="23">23</th><td><u>#include <a href="../../../include/tvm/target/target.h.html">&lt;tvm/target/target.h&gt;</a></u></td></tr>
<tr><th id="24">24</th><td></td></tr>
<tr><th id="25">25</th><td><u>#include <a href="../../../../include/c++/10/string.html">&lt;string&gt;</a></u></td></tr>
<tr><th id="26">26</th><td><u>#include <a href="../../../../include/c++/10/vector.html">&lt;vector&gt;</a></u></td></tr>
<tr><th id="27">27</th><td></td></tr>
<tr><th id="28">28</th><td><u>#include <a href="../../runtime/file_utils.h.html">"../../runtime/file_utils.h"</a></u></td></tr>
<tr><th id="29">29</th><td><u>#include <a href="../../runtime/opencl/aocl/aocl_module.h.html">"../../runtime/opencl/aocl/aocl_module.h"</a></u></td></tr>
<tr><th id="30">30</th><td><u>#include <a href="../build_common.h.html">"../build_common.h"</a></u></td></tr>
<tr><th id="31">31</th><td><u>#include <a href="codegen_opencl.h.html">"codegen_opencl.h"</a></u></td></tr>
<tr><th id="32">32</th><td></td></tr>
<tr><th id="33">33</th><td><b>namespace</b> <span class="namespace">tvm</span> {</td></tr>
<tr><th id="34">34</th><td><b>namespace</b> <span class="namespace">codegen</span> {</td></tr>
<tr><th id="35">35</th><td></td></tr>
<tr><th id="36">36</th><td><span class="namespace">runtime::</span><a class="type" href="../../../include/tvm/runtime/module.h.html#tvm::runtime::Module" title='tvm::runtime::Module' data-ref="tvm::runtime::Module" data-ref-filename="tvm..runtime..Module">Module</a> <dfn class="decl def fn" id="_ZN3tvm7codegen9BuildAOCLENS_8IRModuleENS_6TargetEb" title='tvm::codegen::BuildAOCL' data-ref="_ZN3tvm7codegen9BuildAOCLENS_8IRModuleENS_6TargetEb" data-ref-filename="_ZN3tvm7codegen9BuildAOCLENS_8IRModuleENS_6TargetEb">BuildAOCL</dfn>(<a class="type" href="../../../include/tvm/ir/module.h.html#tvm::IRModule" title='tvm::IRModule' data-ref="tvm::IRModule" data-ref-filename="tvm..IRModule">IRModule</a> <dfn class="local col3 decl" id="53mod" title='mod' data-type='tvm::IRModule' data-ref="53mod" data-ref-filename="53mod">mod</dfn>, <a class="type" href="../../../include/tvm/target/target.h.html#tvm::Target" title='tvm::Target' data-ref="tvm::Target" data-ref-filename="tvm..Target">Target</a> <dfn class="local col4 decl" id="54target" title='target' data-type='tvm::Target' data-ref="54target" data-ref-filename="54target">target</dfn>, <em>bool</em> <dfn class="local col5 decl" id="55emulation" title='emulation' data-type='bool' data-ref="55emulation" data-ref-filename="55emulation">emulation</dfn>) {</td></tr>
<tr><th id="37">37</th><td>  <i>// Get code.</i></td></tr>
<tr><th id="38">38</th><td>  <b>using</b> <span class="namespace">tvm::runtime::</span>Registry;</td></tr>
<tr><th id="39">39</th><td>  <em>bool</em> <dfn class="local col6 decl" id="56output_ssa" title='output_ssa' data-type='bool' data-ref="56output_ssa" data-ref-filename="56output_ssa">output_ssa</dfn> = <b>false</b>;</td></tr>
<tr><th id="40">40</th><td>  <a class="type" href="codegen_opencl.h.html#tvm::codegen::CodeGenOpenCL" title='tvm::codegen::CodeGenOpenCL' data-ref="tvm::codegen::CodeGenOpenCL" data-ref-filename="tvm..codegen..CodeGenOpenCL">CodeGenOpenCL</a> <a class="ref fn fake" href="codegen_opencl.h.html#_ZN3tvm7codegen13CodeGenOpenCLC1Ev" title='tvm::codegen::CodeGenOpenCL::CodeGenOpenCL' data-ref="_ZN3tvm7codegen13CodeGenOpenCLC1Ev" data-ref-filename="_ZN3tvm7codegen13CodeGenOpenCLC1Ev"></a><dfn class="local col7 decl" id="57cg" title='cg' data-type='tvm::codegen::CodeGenOpenCL' data-ref="57cg" data-ref-filename="57cg">cg</dfn>;</td></tr>
<tr><th id="41">41</th><td>  <a class="local col7 ref" href="#57cg" title='cg' data-ref="57cg" data-ref-filename="57cg">cg</a>.<a class="ref fn" href="codegen_c.h.html#_ZN3tvm7codegen8CodeGenC4InitEb" title='tvm::codegen::CodeGenC::Init' data-ref="_ZN3tvm7codegen8CodeGenC4InitEb" data-ref-filename="_ZN3tvm7codegen8CodeGenC4InitEb">Init</a>(<a class="local col6 ref" href="#56output_ssa" title='output_ssa' data-ref="56output_ssa" data-ref-filename="56output_ssa">output_ssa</a>);</td></tr>
<tr><th id="42">42</th><td></td></tr>
<tr><th id="43">43</th><td>  <b>for</b> (<em>auto</em> <dfn class="local col8 decl" id="58kv" title='kv' data-type='std::pair&lt;GlobalVar, BaseFunc&gt;' data-ref="58kv" data-ref-filename="58kv">kv</dfn> : <a class="local col3 ref" href="#53mod" title='mod' data-ref="53mod" data-ref-filename="53mod">mod</a><a class="ref fn" href="../../../include/tvm/ir/module.h.html#_ZNK3tvm8IRModuleptEv" title='tvm::IRModule::operator-&gt;' data-ref="_ZNK3tvm8IRModuleptEv" data-ref-filename="_ZNK3tvm8IRModuleptEv">-&gt;</a><a class="ref field" href="../../../include/tvm/ir/module.h.html#tvm::IRModuleNode::functions" title='tvm::IRModuleNode::functions' data-ref="tvm::IRModuleNode::functions" data-ref-filename="tvm..IRModuleNode..functions">functions</a>) {</td></tr>
<tr><th id="44">44</th><td>    <a class="macro" href="../../../include/tvm/runtime/logging.h.html#681" title="if (!(kv.second-&gt;IsInstance&lt;PrimFuncNode&gt;())) ::tvm::runtime::detail::LogFatal(&quot;/home/runner/work/tvm-woboq/tvm-woboq/tvm/src/target/source/codegen_aocl.cc&quot;, 44).stream() &lt;&lt; ::tvm::runtime::detail::kTVM_INTERNAL_ERROR_MESSAGE &lt;&lt; &quot;  &quot; &lt;&lt; &quot;Check failed: (&quot; &quot;kv.second-&gt;IsInstance&lt;PrimFuncNode&gt;()&quot; &lt;&lt; &quot;) is false: &quot;" data-ref="_M/ICHECK">ICHECK</a>(<a class="local col8 ref" href="#58kv" title='kv' data-ref="58kv" data-ref-filename="58kv">kv</a>.<a class="ref field" href="../../../../include/c++/10/bits/stl_pair.h.html#std::pair::second" title='std::pair&lt;tvm::GlobalVar, tvm::BaseFunc&gt;::second' data-ref="std::pair::second" data-ref-filename="std..pair..second">second</a><a class="ref fn" href="../../../include/tvm/ir/function.h.html#145" title='tvm::BaseFunc::operator-&gt;' data-ref="_ZNK3tvm8BaseFuncptEv" data-ref-filename="_ZNK3tvm8BaseFuncptEv">-&gt;</a><a class="ref fn" href="../../../include/tvm/runtime/object.h.html#_ZNK3tvm7runtime6Object10IsInstanceEv" title='tvm::runtime::Object::IsInstance' data-ref="_ZNK3tvm7runtime6Object10IsInstanceEv" data-ref-filename="_ZNK3tvm7runtime6Object10IsInstanceEv">IsInstance</a>&lt;<a class="type" href="../../../include/tvm/tir/function.h.html#tvm::tir::PrimFuncNode" title='tvm::tir::PrimFuncNode' data-ref="tvm::tir::PrimFuncNode" data-ref-filename="tvm..tir..PrimFuncNode">PrimFuncNode</a>&gt;()) <a class="ref fn" href="../../../../include/c++/10/ostream.html#_ZStlsRSt13basic_ostreamIcT_EPKc" title='std::operator&lt;&lt;' data-ref="_ZStlsRSt13basic_ostreamIcT_EPKc" data-ref-filename="_ZStlsRSt13basic_ostreamIcT_EPKc">&lt;&lt;</a> <q>"CodegenOpenCL: Can only take PrimFunc"</q>;</td></tr>
<tr><th id="45">45</th><td>    <em>auto</em> <dfn class="local col9 decl" id="59f" title='f' data-type='tvm::tir::PrimFunc' data-ref="59f" data-ref-filename="59f">f</dfn> = <a class="ref fn" href="../../../include/tvm/runtime/object.h.html#_ZN3tvm7runtime8DowncastET0_" title='tvm::runtime::Downcast' data-ref="_ZN3tvm7runtime8DowncastET0_" data-ref-filename="_ZN3tvm7runtime8DowncastET0_">Downcast</a>&lt;<a class="type" href="../../../include/tvm/tir/function.h.html#tvm::tir::PrimFunc" title='tvm::tir::PrimFunc' data-ref="tvm::tir::PrimFunc" data-ref-filename="tvm..tir..PrimFunc">PrimFunc</a>&gt;(<a class="ref fn fake" href="../../../include/tvm/ir/function.h.html#145" title='tvm::BaseFunc::BaseFunc' data-ref="_ZN3tvm8BaseFuncC1ERKS0_" data-ref-filename="_ZN3tvm8BaseFuncC1ERKS0_"></a><a class="local col8 ref" href="#58kv" title='kv' data-ref="58kv" data-ref-filename="58kv">kv</a>.<a class="ref field" href="../../../../include/c++/10/bits/stl_pair.h.html#std::pair::second" title='std::pair&lt;tvm::GlobalVar, tvm::BaseFunc&gt;::second' data-ref="std::pair::second" data-ref-filename="std..pair..second">second</a>);</td></tr>
<tr><th id="46">46</th><td>    <em>auto</em> <dfn class="local col0 decl" id="60calling_conv" title='calling_conv' data-type='Optional&lt;tvm::Integer&gt;' data-ref="60calling_conv" data-ref-filename="60calling_conv">calling_conv</dfn> = <a class="local col9 ref" href="#59f" title='f' data-ref="59f" data-ref-filename="59f">f</a><a class="ref fn" href="../../../include/tvm/tir/function.h.html#188" title='tvm::tir::PrimFunc::operator-&gt;' data-ref="_ZNK3tvm3tir8PrimFuncptEv" data-ref-filename="_ZNK3tvm3tir8PrimFuncptEv">-&gt;</a><a class="ref fn" href="../../../include/tvm/ir/function.h.html#_ZNK3tvm12BaseFuncNode7GetAttrERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEENS_7runtime8OptionalIT_EE" title='tvm::BaseFuncNode::GetAttr' data-ref="_ZNK3tvm12BaseFuncNode7GetAttrERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEENS_7runtime8OptionalIT_EE" data-ref-filename="_ZNK3tvm12BaseFuncNode7GetAttrERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEENS_7runtime8OptionalIT_EE">GetAttr</a>&lt;<a class="type" href="../../../include/tvm/ir/expr.h.html#tvm::Integer" title='tvm::Integer' data-ref="tvm::Integer" data-ref-filename="tvm..Integer">Integer</a>&gt;(<a class="ref fn fake" href="../../../../include/c++/10/bits/basic_string.h.html#_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" title='std::basic_string::basic_string&lt;_CharT, _Traits, _Alloc&gt;' data-ref="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" data-ref-filename="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_"></a><span class="namespace">tvm::attr::</span><a class="ref" href="../../../include/tvm/ir/function.h.html#tvm::attr::kCallingConv" title='tvm::attr::kCallingConv' data-ref="tvm::attr::kCallingConv" data-ref-filename="tvm..attr..kCallingConv">kCallingConv</a>);</td></tr>
<tr><th id="47">47</th><td>    <a class="macro" href="../../../include/tvm/runtime/logging.h.html#681" title="if (!(calling_conv == CallingConv::kDeviceKernelLaunch)) ::tvm::runtime::detail::LogFatal(&quot;/home/runner/work/tvm-woboq/tvm-woboq/tvm/src/target/source/codegen_aocl.cc&quot;, 47).stream() &lt;&lt; ::tvm::runtime::detail::kTVM_INTERNAL_ERROR_MESSAGE &lt;&lt; &quot;  &quot; &lt;&lt; &quot;Check failed: (&quot; &quot;calling_conv == CallingConv::kDeviceKernelLaunch&quot; &lt;&lt; &quot;) is false: &quot;" data-ref="_M/ICHECK">ICHECK</a>(<a class="local col0 ref" href="#60calling_conv" title='calling_conv' data-ref="60calling_conv" data-ref-filename="60calling_conv">calling_conv</a> <a class="ref fn" href="../../../include/tvm/runtime/container/optional.h.html#_ZNK3tvm7runtime8OptionaleqERKTL0__" title='tvm::runtime::Optional::operator==' data-ref="_ZNK3tvm7runtime8OptionaleqERKTL0__" data-ref-filename="_ZNK3tvm7runtime8OptionaleqERKTL0__">==</a> <a class="type" href="../../../include/tvm/ir/function.h.html#tvm::CallingConv" title='tvm::CallingConv' data-ref="tvm::CallingConv" data-ref-filename="tvm..CallingConv">CallingConv</a>::<a class="enum" href="../../../include/tvm/ir/function.h.html#tvm::CallingConv::kDeviceKernelLaunch" title='tvm::CallingConv::kDeviceKernelLaunch' data-ref="tvm::CallingConv::kDeviceKernelLaunch" data-ref-filename="tvm..CallingConv..kDeviceKernelLaunch">kDeviceKernelLaunch</a>)</td></tr>
<tr><th id="48">48</th><td>        <a class="ref fn" href="../../../../include/c++/10/ostream.html#_ZStlsRSt13basic_ostreamIcT_EPKc" title='std::operator&lt;&lt;' data-ref="_ZStlsRSt13basic_ostreamIcT_EPKc" data-ref-filename="_ZStlsRSt13basic_ostreamIcT_EPKc">&lt;&lt;</a> <q>"CodegenOpenCL: expect calling_conv equals CallingConv::kDeviceKernelLaunch"</q>;</td></tr>
<tr><th id="49">49</th><td>    <a class="local col7 ref" href="#57cg" title='cg' data-ref="57cg" data-ref-filename="57cg">cg</a>.<a class="ref fn" href="codegen_c.h.html#_ZN3tvm7codegen8CodeGenC11AddFunctionERKNS_3tir8PrimFuncE" title='tvm::codegen::CodeGenC::AddFunction' data-ref="_ZN3tvm7codegen8CodeGenC11AddFunctionERKNS_3tir8PrimFuncE" data-ref-filename="_ZN3tvm7codegen8CodeGenC11AddFunctionERKNS_3tir8PrimFuncE">AddFunction</a>(<a class="local col9 ref" href="#59f" title='f' data-ref="59f" data-ref-filename="59f">f</a>);</td></tr>
<tr><th id="50">50</th><td>  }</td></tr>
<tr><th id="51">51</th><td></td></tr>
<tr><th id="52">52</th><td>  <span class="namespace">std::</span><a class="typedef" href="../../../../include/c++/10/bits/stringfwd.h.html#std::string" title='std::string' data-type='basic_string&lt;char&gt;' data-ref="std::string" data-ref-filename="std..string">string</a> <dfn class="local col1 decl" id="61code" title='code' data-type='std::string' data-ref="61code" data-ref-filename="61code">code</dfn> = <a class="local col7 ref" href="#57cg" title='cg' data-ref="57cg" data-ref-filename="57cg">cg</a>.<a class="ref fn" href="codegen_opencl.h.html#_ZN3tvm7codegen13CodeGenOpenCL6FinishB5cxx11Ev" title='tvm::codegen::CodeGenOpenCL::Finish' data-ref="_ZN3tvm7codegen13CodeGenOpenCL6FinishB5cxx11Ev" data-ref-filename="_ZN3tvm7codegen13CodeGenOpenCL6FinishB5cxx11Ev">Finish</a>();</td></tr>
<tr><th id="53">53</th><td>  <b>if</b> (<em>const</em> <em>auto</em>* <dfn class="local col2 decl" id="62f" title='f' data-type='const tvm::runtime::PackedFunc *' data-ref="62f" data-ref-filename="62f"><a class="local col2 ref" href="#62f" title='f' data-ref="62f" data-ref-filename="62f">f</a></dfn> = Registry::<a class="ref fn" href="../../../include/tvm/runtime/registry.h.html#_ZN3tvm7runtime8Registry3GetERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEE" title='tvm::runtime::Registry::Get' data-ref="_ZN3tvm7runtime8Registry3GetERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEE" data-ref-filename="_ZN3tvm7runtime8Registry3GetERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEE">Get</a>(<a class="ref fn fake" href="../../../../include/c++/10/bits/basic_string.h.html#_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" title='std::basic_string::basic_string&lt;_CharT, _Traits, _Alloc&gt;' data-ref="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" data-ref-filename="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_"></a><q>"tvm_callback_opencl_postproc"</q>)) {</td></tr>
<tr><th id="54">54</th><td>    <a class="local col1 ref" href="#61code" title='code' data-ref="61code" data-ref-filename="61code">code</a> <a class="ref fn" href="../../../../include/c++/10/bits/basic_string.h.html#_ZNSt7__cxx1112basic_stringaSEONS_12basic_stringIT_T0_T1_EE" title='std::basic_string::operator=' data-ref="_ZNSt7__cxx1112basic_stringaSEONS_12basic_stringIT_T0_T1_EE" data-ref-filename="_ZNSt7__cxx1112basic_stringaSEONS_12basic_stringIT_T0_T1_EE">=</a> (*<a class="local col2 ref" href="#62f" title='f' data-ref="62f" data-ref-filename="62f">f</a>)<a class="ref fn" href="../../../include/tvm/runtime/packed_func.h.html#_ZNK3tvm7runtime10PackedFuncclEDpOT_" title='tvm::runtime::PackedFunc::operator()' data-ref="_ZNK3tvm7runtime10PackedFuncclEDpOT_" data-ref-filename="_ZNK3tvm7runtime10PackedFuncclEDpOT_">(<a class="local col1 ref" href="#61code" title='code' data-ref="61code" data-ref-filename="61code">code</a>)</a>.<a class="ref fn" href="../../../include/tvm/runtime/packed_func.h.html#_ZNK3tvm7runtime11TVMRetValuecvNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEEv" title='tvm::runtime::TVMRetValue::operator basic_string' data-ref="_ZNK3tvm7runtime11TVMRetValuecvNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEEv" data-ref-filename="_ZNK3tvm7runtime11TVMRetValuecvNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEEv"><b>operator</b> std::string</a>();</td></tr>
<tr><th id="55">55</th><td>  }</td></tr>
<tr><th id="56">56</th><td></td></tr>
<tr><th id="57">57</th><td>  <i>// Write a .cl file.</i></td></tr>
<tr><th id="58">58</th><td>  <span class="namespace">runtime::</span><a class="ref fn" href="../../runtime/file_utils.h.html#_ZN3tvm7runtime16SaveBinaryToFileERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEES8_" title='tvm::runtime::SaveBinaryToFile' data-ref="_ZN3tvm7runtime16SaveBinaryToFileERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEES8_" data-ref-filename="_ZN3tvm7runtime16SaveBinaryToFileERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEES8_">SaveBinaryToFile</a>(<a class="ref fn fake" href="../../../../include/c++/10/bits/basic_string.h.html#_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" title='std::basic_string::basic_string&lt;_CharT, _Traits, _Alloc&gt;' data-ref="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" data-ref-filename="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_"></a><q>"aocl.cl"</q>, <a class="ref fn fake" href="../../../../include/c++/10/bits/basic_string.h.html#_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" title='std::basic_string::basic_string&lt;_CharT, _Traits, _Alloc&gt;' data-ref="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" data-ref-filename="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_"></a><a class="local col1 ref" href="#61code" title='code' data-ref="61code" data-ref-filename="61code">code</a>.<a class="ref fn" href="../../../../include/c++/10/bits/basic_string.h.html#_ZNKSt7__cxx1112basic_string5c_strEv" title='std::basic_string::c_str' data-ref="_ZNKSt7__cxx1112basic_string5c_strEv" data-ref-filename="_ZNKSt7__cxx1112basic_string5c_strEv">c_str</a>());</td></tr>
<tr><th id="59">59</th><td></td></tr>
<tr><th id="60">60</th><td>  <i>// Compile the .cl file.</i></td></tr>
<tr><th id="61">61</th><td>  <span class="namespace">std::</span><a class="typedef" href="../../../../include/c++/10/bits/stringfwd.h.html#std::string" title='std::string' data-type='basic_string&lt;char&gt;' data-ref="std::string" data-ref-filename="std..string">string</a> <dfn class="local col3 decl" id="63cmd" title='cmd' data-type='std::string' data-ref="63cmd" data-ref-filename="63cmd">cmd</dfn> = <a class="ref fn fake" href="../../../../include/c++/10/bits/basic_string.h.html#_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" title='std::basic_string::basic_string&lt;_CharT, _Traits, _Alloc&gt;' data-ref="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" data-ref-filename="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_"></a><q>"aoc aocl.cl"</q>;</td></tr>
<tr><th id="62">62</th><td>  <i>// AOCL supports fp64.</i></td></tr>
<tr><th id="63">63</th><td>  <a class="local col3 ref" href="#63cmd" title='cmd' data-ref="63cmd" data-ref-filename="63cmd">cmd</a> <a class="ref fn" href="../../../../include/c++/10/bits/basic_string.h.html#_ZNSt7__cxx1112basic_stringpLEPKT_" title='std::basic_string::operator+=' data-ref="_ZNSt7__cxx1112basic_stringpLEPKT_" data-ref-filename="_ZNSt7__cxx1112basic_stringpLEPKT_">+=</a> <q>" -Dcl_khr_fp64"</q>;</td></tr>
<tr><th id="64">64</th><td>  <a class="type" href="../../../include/tvm/runtime/container/optional.h.html#tvm::runtime::Optional" title='tvm::runtime::Optional' data-ref="tvm::runtime::Optional" data-ref-filename="tvm..runtime..Optional">Optional</a>&lt;String&gt; <dfn class="local col4 decl" id="64device" title='device' data-type='Optional&lt;tvm::runtime::String&gt;' data-ref="64device" data-ref-filename="64device">device</dfn> = <a class="local col4 ref" href="#54target" title='target' data-ref="54target" data-ref-filename="54target">target</a><a class="ref fn" href="../../../include/tvm/target/target.h.html#211" title='tvm::Target::operator-&gt;' data-ref="_ZNK3tvm6TargetptEv" data-ref-filename="_ZNK3tvm6TargetptEv">-&gt;</a><a class="ref fn" href="../../../include/tvm/target/target.h.html#_ZNK3tvm10TargetNode7GetAttrERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEENS_7runtime8OptionalIT_EE" title='tvm::TargetNode::GetAttr' data-ref="_ZNK3tvm10TargetNode7GetAttrERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEENS_7runtime8OptionalIT_EE" data-ref-filename="_ZNK3tvm10TargetNode7GetAttrERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEENS_7runtime8OptionalIT_EE">GetAttr</a>&lt;String&gt;(<a class="ref fn fake" href="../../../../include/c++/10/bits/basic_string.h.html#_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" title='std::basic_string::basic_string&lt;_CharT, _Traits, _Alloc&gt;' data-ref="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" data-ref-filename="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_"></a><q>"device"</q>);</td></tr>
<tr><th id="65">65</th><td>  <b>if</b> (<a class="local col4 ref" href="#64device" title='device' data-ref="64device" data-ref-filename="64device">device</a>.<a class="ref fn" href="../../../include/tvm/runtime/object.h.html#_ZNK3tvm7runtime9ObjectRef7definedEv" title='tvm::runtime::ObjectRef::defined' data-ref="_ZNK3tvm7runtime9ObjectRef7definedEv" data-ref-filename="_ZNK3tvm7runtime9ObjectRef7definedEv">defined</a>()) {</td></tr>
<tr><th id="66">66</th><td>    <a class="local col3 ref" href="#63cmd" title='cmd' data-ref="63cmd" data-ref-filename="63cmd">cmd</a> <a class="ref fn" href="../../../../include/c++/10/bits/basic_string.h.html#_ZNSt7__cxx1112basic_stringpLERKNS_12basic_stringIT_T0_T1_EE" title='std::basic_string::operator+=' data-ref="_ZNSt7__cxx1112basic_stringpLERKNS_12basic_stringIT_T0_T1_EE" data-ref-filename="_ZNSt7__cxx1112basic_stringpLERKNS_12basic_stringIT_T0_T1_EE">+=</a> <a class="ref fn fake" href="../../../include/tvm/runtime/container/string.h.html#_ZNK3tvm7runtime6StringcvNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEEv" title='tvm::runtime::String::operator basic_string' data-ref="_ZNK3tvm7runtime6StringcvNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEEv" data-ref-filename="_ZNK3tvm7runtime6StringcvNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEEv"></a><q>" -board="</q> <a class="ref fn" href="../../../include/tvm/runtime/container/string.h.html#_ZN3tvm7runtimeplEPKcRKNS0_6StringE" title='tvm::runtime::operator+' data-ref="_ZN3tvm7runtimeplEPKcRKNS0_6StringE" data-ref-filename="_ZN3tvm7runtimeplEPKcRKNS0_6StringE">+</a> <a class="local col4 ref" href="#64device" title='device' data-ref="64device" data-ref-filename="64device">device</a>.<a class="ref fn" href="../../../include/tvm/runtime/container/optional.h.html#_ZNK3tvm7runtime8Optional5valueEv" title='tvm::runtime::Optional::value' data-ref="_ZNK3tvm7runtime8Optional5valueEv" data-ref-filename="_ZNK3tvm7runtime8Optional5valueEv">value</a>();</td></tr>
<tr><th id="67">67</th><td>  }</td></tr>
<tr><th id="68">68</th><td>  <b>if</b> (<a class="local col5 ref" href="#55emulation" title='emulation' data-ref="55emulation" data-ref-filename="55emulation">emulation</a>) {</td></tr>
<tr><th id="69">69</th><td>    <a class="local col3 ref" href="#63cmd" title='cmd' data-ref="63cmd" data-ref-filename="63cmd">cmd</a> <a class="ref fn" href="../../../../include/c++/10/bits/basic_string.h.html#_ZNSt7__cxx1112basic_stringpLEPKT_" title='std::basic_string::operator+=' data-ref="_ZNSt7__cxx1112basic_stringpLEPKT_" data-ref-filename="_ZNSt7__cxx1112basic_stringpLEPKT_">+=</a> <q>" -march=emulator"</q>;</td></tr>
<tr><th id="70">70</th><td>  }</td></tr>
<tr><th id="71">71</th><td>  <b>if</b> (<a class="ref fn" href="../../../../include/stdlib.h.html#system" title='system' data-ref="system" data-ref-filename="system">system</a>(<a class="local col3 ref" href="#63cmd" title='cmd' data-ref="63cmd" data-ref-filename="63cmd">cmd</a>.<a class="ref fn" href="../../../../include/c++/10/bits/basic_string.h.html#_ZNKSt7__cxx1112basic_string5c_strEv" title='std::basic_string::c_str' data-ref="_ZNKSt7__cxx1112basic_string5c_strEv" data-ref-filename="_ZNKSt7__cxx1112basic_string5c_strEv">c_str</a>()) != <var>0</var>) {</td></tr>
<tr><th id="72">72</th><td>    <a class="macro" href="../../../include/tvm/runtime/logging.h.html#572" title="::tvm::runtime::detail::LogFatal(&quot;/home/runner/work/tvm-woboq/tvm-woboq/tvm/src/target/source/codegen_aocl.cc&quot;, 72).stream()" data-ref="_M/LOG">LOG</a>(FATAL) <a class="ref fn" href="../../../../include/c++/10/ostream.html#_ZStlsRSt13basic_ostreamIcT_EPKc" title='std::operator&lt;&lt;' data-ref="_ZStlsRSt13basic_ostreamIcT_EPKc" data-ref-filename="_ZStlsRSt13basic_ostreamIcT_EPKc">&lt;&lt;</a> <q>"OpenCL offline compilation error."</q>;</td></tr>
<tr><th id="73">73</th><td>  }</td></tr>
<tr><th id="74">74</th><td></td></tr>
<tr><th id="75">75</th><td>  <i>// Read .aocx file</i></td></tr>
<tr><th id="76">76</th><td>  <span class="namespace">std::</span><a class="typedef" href="../../../../include/c++/10/bits/stringfwd.h.html#std::string" title='std::string' data-type='basic_string&lt;char&gt;' data-ref="std::string" data-ref-filename="std..string">string</a> <a class="ref fn fake" href="../../../../include/c++/10/bits/basic_string.h.html#_ZNSt7__cxx1112basic_stringC1Ev" title='std::basic_string::basic_string&lt;_CharT, _Traits, _Alloc&gt;' data-ref="_ZNSt7__cxx1112basic_stringC1Ev" data-ref-filename="_ZNSt7__cxx1112basic_stringC1Ev"></a><dfn class="local col5 decl" id="65aocxbin" title='aocxbin' data-type='std::string' data-ref="65aocxbin" data-ref-filename="65aocxbin">aocxbin</dfn>;</td></tr>
<tr><th id="77">77</th><td>  <span class="namespace">runtime::</span><a class="ref fn" href="../../runtime/file_utils.h.html#_ZN3tvm7runtime18LoadBinaryFromFileERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEPS6_" title='tvm::runtime::LoadBinaryFromFile' data-ref="_ZN3tvm7runtime18LoadBinaryFromFileERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEPS6_" data-ref-filename="_ZN3tvm7runtime18LoadBinaryFromFileERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEPS6_">LoadBinaryFromFile</a>(<a class="ref fn fake" href="../../../../include/c++/10/bits/basic_string.h.html#_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" title='std::basic_string::basic_string&lt;_CharT, _Traits, _Alloc&gt;' data-ref="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" data-ref-filename="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_"></a><q>"aocl.aocx"</q>, &amp;<a class="local col5 ref" href="#65aocxbin" title='aocxbin' data-ref="65aocxbin" data-ref-filename="65aocxbin">aocxbin</a>);</td></tr>
<tr><th id="78">78</th><td></td></tr>
<tr><th id="79">79</th><td>  <b>return</b> <a class="ref fn" href="../../runtime/opencl/aocl/aocl_module.h.html#_ZN3tvm7runtime16AOCLModuleCreateENSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEES6_St13unordered_mapIS6_NS0_12FunctionInfoESt4hashIS6_ESt8equal_6085770" title='tvm::runtime::AOCLModuleCreate' data-ref="_ZN3tvm7runtime16AOCLModuleCreateENSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEES6_St13unordered_mapIS6_NS0_12FunctionInfoESt4hashIS6_ESt8equal_6085770" data-ref-filename="_ZN3tvm7runtime16AOCLModuleCreateENSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEES6_St13unordered_mapIS6_NS0_12FunctionInfoESt4hashIS6_ESt8equal_6085770">AOCLModuleCreate</a>(<a class="ref fn fake" href="../../../../include/c++/10/bits/basic_string.h.html#_ZNSt7__cxx1112basic_stringC1ERKNS_12basic_stringIT_T0_T1_EE" title='std::basic_string::basic_string&lt;_CharT, _Traits, _Alloc&gt;' data-ref="_ZNSt7__cxx1112basic_stringC1ERKNS_12basic_stringIT_T0_T1_EE" data-ref-filename="_ZNSt7__cxx1112basic_stringC1ERKNS_12basic_stringIT_T0_T1_EE"></a><a class="local col5 ref" href="#65aocxbin" title='aocxbin' data-ref="65aocxbin" data-ref-filename="65aocxbin">aocxbin</a>, <a class="ref fn fake" href="../../../../include/c++/10/bits/basic_string.h.html#_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" title='std::basic_string::basic_string&lt;_CharT, _Traits, _Alloc&gt;' data-ref="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" data-ref-filename="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_"></a><q>"aocx"</q>, <a class="ref fn" href="../build_common.h.html#_ZN3tvm7codegen15ExtractFuncInfoB5cxx11ERKNS_8IRModuleE" title='tvm::codegen::ExtractFuncInfo' data-ref="_ZN3tvm7codegen15ExtractFuncInfoB5cxx11ERKNS_8IRModuleE" data-ref-filename="_ZN3tvm7codegen15ExtractFuncInfoB5cxx11ERKNS_8IRModuleE">ExtractFuncInfo</a>(<a class="local col3 ref" href="#53mod" title='mod' data-ref="53mod" data-ref-filename="53mod">mod</a>), <a class="ref fn fake" href="../../../../include/c++/10/bits/basic_string.h.html#_ZNSt7__cxx1112basic_stringC1ERKNS_12basic_stringIT_T0_T1_EE" title='std::basic_string::basic_string&lt;_CharT, _Traits, _Alloc&gt;' data-ref="_ZNSt7__cxx1112basic_stringC1ERKNS_12basic_stringIT_T0_T1_EE" data-ref-filename="_ZNSt7__cxx1112basic_stringC1ERKNS_12basic_stringIT_T0_T1_EE"></a><a class="local col1 ref" href="#61code" title='code' data-ref="61code" data-ref-filename="61code">code</a>);</td></tr>
<tr><th id="80">80</th><td>}</td></tr>
<tr><th id="81">81</th><td></td></tr>
<tr><th id="82">82</th><td><a class="macro" href="../../../include/tvm/runtime/registry.h.html#339" title="static __attribute__((unused)) ::tvm::runtime::Registry&amp; __mk_TVM0 = ::tvm::runtime::Registry::Register(&quot;target.build.aocl&quot;)" data-ref="_M/TVM_REGISTER_GLOBAL">TVM_REGISTER_GLOBAL</a>(<a class="ref fn fake" href="../../../../include/c++/10/bits/basic_string.h.html#_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" title='std::basic_string::basic_string&lt;_CharT, _Traits, _Alloc&gt;' data-ref="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" data-ref-filename="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_"></a><q>"target.build.aocl"</q>)</td></tr>
<tr><th id="83">83</th><td>    .<a class="tu ref fn" href="../../../include/tvm/runtime/registry.h.html#_ZN3tvm7runtime8Registry14set_body_typedET_" title='tvm::runtime::Registry::set_body_typed' data-use='c' data-ref="_ZN3tvm7runtime8Registry14set_body_typedET_" data-ref-filename="_ZN3tvm7runtime8Registry14set_body_typedET_">set_body_typed</a>([](<a class="type" href="../../../include/tvm/ir/module.h.html#tvm::IRModule" title='tvm::IRModule' data-ref="tvm::IRModule" data-ref-filename="tvm..IRModule">IRModule</a> <dfn class="local col6 decl" id="66mod" title='mod' data-type='tvm::IRModule' data-ref="66mod" data-ref-filename="66mod">mod</dfn>, <a class="type" href="../../../include/tvm/target/target.h.html#tvm::Target" title='tvm::Target' data-ref="tvm::Target" data-ref-filename="tvm..Target">Target</a> <dfn class="local col7 decl" id="67target" title='target' data-type='tvm::Target' data-ref="67target" data-ref-filename="67target">target</dfn>) -&gt; <span class="namespace">runtime::</span><a class="type" href="../../../include/tvm/runtime/module.h.html#tvm::runtime::Module" title='tvm::runtime::Module' data-ref="tvm::runtime::Module" data-ref-filename="tvm..runtime..Module">Module</a> {</td></tr>
<tr><th id="84">84</th><td>      <b>return</b> <a class="ref fn" href="#_ZN3tvm7codegen9BuildAOCLENS_8IRModuleENS_6TargetEb" title='tvm::codegen::BuildAOCL' data-ref="_ZN3tvm7codegen9BuildAOCLENS_8IRModuleENS_6TargetEb" data-ref-filename="_ZN3tvm7codegen9BuildAOCLENS_8IRModuleENS_6TargetEb">BuildAOCL</a>(<a class="ref fn fake" href="../../../include/tvm/ir/module.h.html#352" title='tvm::IRModule::IRModule' data-ref="_ZN3tvm8IRModuleC1ERKS0_" data-ref-filename="_ZN3tvm8IRModuleC1ERKS0_"></a><a class="local col6 ref" href="#66mod" title='mod' data-ref="66mod" data-ref-filename="66mod">mod</a>, <a class="ref fn fake" href="../../../include/tvm/target/target.h.html#211" title='tvm::Target::Target' data-ref="_ZN3tvm6TargetC1ERKS0_" data-ref-filename="_ZN3tvm6TargetC1ERKS0_"></a><a class="local col7 ref" href="#67target" title='target' data-ref="67target" data-ref-filename="67target">target</a>, <b>false</b>);</td></tr>
<tr><th id="85">85</th><td>    });</td></tr>
<tr><th id="86">86</th><td></td></tr>
<tr><th id="87">87</th><td><a class="macro" href="../../../include/tvm/runtime/registry.h.html#339" title="static __attribute__((unused)) ::tvm::runtime::Registry&amp; __mk_TVM2 = ::tvm::runtime::Registry::Register(&quot;target.build.aocl_sw_emu&quot;)" data-ref="_M/TVM_REGISTER_GLOBAL">TVM_REGISTER_GLOBAL</a>(<a class="ref fn fake" href="../../../../include/c++/10/bits/basic_string.h.html#_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" title='std::basic_string::basic_string&lt;_CharT, _Traits, _Alloc&gt;' data-ref="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_" data-ref-filename="_ZNSt7__cxx1112basic_stringC1EPKT_RKT1_"></a><q>"target.build.aocl_sw_emu"</q>)</td></tr>
<tr><th id="88">88</th><td>    .<a class="tu ref fn" href="../../../include/tvm/runtime/registry.h.html#_ZN3tvm7runtime8Registry14set_body_typedET_" title='tvm::runtime::Registry::set_body_typed' data-use='c' data-ref="_ZN3tvm7runtime8Registry14set_body_typedET_" data-ref-filename="_ZN3tvm7runtime8Registry14set_body_typedET_">set_body_typed</a>([](<a class="type" href="../../../include/tvm/ir/module.h.html#tvm::IRModule" title='tvm::IRModule' data-ref="tvm::IRModule" data-ref-filename="tvm..IRModule">IRModule</a> <dfn class="local col8 decl" id="68mod" title='mod' data-type='tvm::IRModule' data-ref="68mod" data-ref-filename="68mod">mod</dfn>, <a class="type" href="../../../include/tvm/target/target.h.html#tvm::Target" title='tvm::Target' data-ref="tvm::Target" data-ref-filename="tvm..Target">Target</a> <dfn class="local col9 decl" id="69target" title='target' data-type='tvm::Target' data-ref="69target" data-ref-filename="69target">target</dfn>) -&gt; <span class="namespace">runtime::</span><a class="type" href="../../../include/tvm/runtime/module.h.html#tvm::runtime::Module" title='tvm::runtime::Module' data-ref="tvm::runtime::Module" data-ref-filename="tvm..runtime..Module">Module</a> {</td></tr>
<tr><th id="89">89</th><td>      <b>return</b> <a class="ref fn" href="#_ZN3tvm7codegen9BuildAOCLENS_8IRModuleENS_6TargetEb" title='tvm::codegen::BuildAOCL' data-ref="_ZN3tvm7codegen9BuildAOCLENS_8IRModuleENS_6TargetEb" data-ref-filename="_ZN3tvm7codegen9BuildAOCLENS_8IRModuleENS_6TargetEb">BuildAOCL</a>(<a class="ref fn fake" href="../../../include/tvm/ir/module.h.html#352" title='tvm::IRModule::IRModule' data-ref="_ZN3tvm8IRModuleC1ERKS0_" data-ref-filename="_ZN3tvm8IRModuleC1ERKS0_"></a><a class="local col8 ref" href="#68mod" title='mod' data-ref="68mod" data-ref-filename="68mod">mod</a>, <a class="ref fn fake" href="../../../include/tvm/target/target.h.html#211" title='tvm::Target::Target' data-ref="_ZN3tvm6TargetC1ERKS0_" data-ref-filename="_ZN3tvm6TargetC1ERKS0_"></a><a class="local col9 ref" href="#69target" title='target' data-ref="69target" data-ref-filename="69target">target</a>, <b>true</b>);</td></tr>
<tr><th id="90">90</th><td>    });</td></tr>
<tr><th id="91">91</th><td></td></tr>
<tr><th id="92">92</th><td>}  <i>// namespace codegen</i></td></tr>
<tr><th id="93">93</th><td>}  <i>// namespace tvm</i></td></tr>
<tr><th id="94">94</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2022-Aug-12</em> from project tvm revision <em>369e8b2</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
